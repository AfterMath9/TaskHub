<!-- Top intro with stats -->
<section class="about-hero glass-card">
  <div>
    <h1>About TaskHub</h1>
    <p class="muted">We coordinate workshops, coaching, and community support so every learner can plan, prioritise, and ship meaningful projects.</p>
  </div>
  <div class="about-stats">
    <div class="stat">
      <span class="stat-value">{{metrics.workshops}}</span>
      <span class="stat-label">Workshops curated</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{metrics.members}}</span>
      <span class="stat-label">Experts on the team</span>
    </div>
  </div>
</section>

<!-- Team listing and admin tools -->
<section class="team-section">
  <header class="team-header">
    <h2>Meet the team</h2>
    <p class="muted small">A multidisciplinary crew supporting engineering, design, and operations.</p>
  </header>

  {{#if (eq user.role "admin")}}
    <!-- Admins can add new team members -->
    <section class="glass-card admin-form">
      <h3>Add Team Member</h3>
      <form method="POST" action="/admin/team" class="admin-form-grid" enctype="multipart/form-data">
        <input type="hidden" name="redirect_to" value="/about">
        <label>
          <span>Name</span>
          <input type="text" name="name" placeholder="Full name" required minlength="3">
        </label>
        <label>
          <span>Role</span>
          <input type="text" name="role" placeholder="Primary role" required minlength="2">
        </label>
        <label class="wide">
          <span>Bio</span>
          <textarea name="bio" placeholder="Short background" required minlength="10"></textarea>
        </label>
        <label>
          <span>Avatar Image (optional)</span>
          <input type="file" name="avatar" accept="image/png,image/jpeg">
        </label>
        <div class="form-actions">
          <button class="btn" type="submit">Add Member</button>
        </div>
      </form>
    </section>
  {{/if}}

  <div class="team-grid">
    {{#each team}}
      <article class="team-card glass-card">
        {{#if (eq ../user.role "admin")}}
          <!-- Admin edit form for each teammate -->
          <form method="POST" action="/admin/team/{{id}}/update" class="admin-card-form" enctype="multipart/form-data">
            <input type="hidden" name="redirect_to" value="/about">
            <div class="team-avatar">
              {{#if avatar_path}}
                <img src="{{avatar_path}}" alt="{{name}}" />
              {{else}}
                <span>{{initials this}}</span>
              {{/if}}
            </div>
            <label>
              <span>Name</span>
              <input type="text" name="name" value="{{name}}" required>
            </label>
            <label>
              <span>Role</span>
              <input type="text" name="role" value="{{role}}" required>
            </label>
            <label>
              <span>Bio</span>
              <textarea name="bio" required>{{bio}}</textarea>
            </label>
            <label>
              <span>Replace Avatar (optional)</span>
              <input type="file" name="avatar" accept="image/png,image/jpeg">
            </label>
            {{#if avatar_path}}
              <label class="checkbox">
                <input type="checkbox" name="remove_avatar" value="1">
                <span>Remove current avatar</span>
              </label>
            {{/if}}
            <div class="action-buttons">
              <button class="btn btn-success" type="submit">Save</button>
            </div>
          </form>
          <form method="POST" action="/admin/team/{{id}}/delete" onsubmit="return confirm('Remove {{name}} from the team?');">
            <input type="hidden" name="redirect_to" value="/about">
            <button class="btn btn-danger" type="submit">Delete</button>
          </form>
        {{else}}
          <!-- Regular visitors just see the profile -->
          <div class="team-avatar">
            {{#if avatar_path}}
              <img src="{{avatar_path}}" alt="{{name}}" />
            {{else}}
              <span>{{initials this}}</span>
            {{/if}}
          </div>
          <h3>{{name}}</h3>
          <p class="muted">{{role}}</p>
          <p>{{bio}}</p>
        {{/if}}
      </article>
    {{/each}}
  </div>
  {{#if (gt teamPagination.pages 1)}}
    <!-- Simple pagination for the team list -->
    <nav class="pagination team-pagination">
      {{#if teamPagination.hasPrev}}
        <a class="page-link" href="/about?teamPage={{minus teamPagination.page 1}}">Previous</a>
      {{else}}
        <span class="page-link disabled">Previous</span>
      {{/if}}
      {{#each teamPagination.pageNumbers}}
        {{#if (eq ../teamPagination.page this)}}
          <span class="page-link active">{{this}}</span>
        {{else}}
          <a class="page-link" href="/about?teamPage={{this}}">{{this}}</a>
        {{/if}}
      {{/each}}
      {{#if teamPagination.hasNext}}
        <a class="page-link" href="/about?teamPage={{plus teamPagination.page 1}}">Next</a>
      {{else}}
        <span class="page-link disabled">Next</span>
      {{/if}}
    </nav>
  {{/if}}
</section>
