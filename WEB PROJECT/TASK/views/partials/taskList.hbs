<section class="card">
  <h2>Your Tasks</h2>
  {{#if tasks.length}}
    <ul class="tasks grid3">
      {{#each tasks}}
        <li class="task {{#if (eq this.is_done 1)}}done{{/if}}">
          <div class="task-row">
            <form method="POST" action="/tasks/{{this.id}}/toggle">
              <button title="Toggle done">{{#if (eq this.is_done 1)}}☑{{else}}☐{{/if}}</button>
            </form>
            <div class="task-main">
              <a class="title" href="/tasks/{{this.id}}">{{this.title}}</a>
              {{#if this.category}}<span class="chip">{{this.category}}</span>{{/if}}
              <span class="when">{{this.created_at}}</span>
            </div>
            <form method="POST" action="/tasks/{{this.id}}/delete">
              <button class="danger" title="Delete">✕</button>
            </form>
          </div>

          <!-- inline edit -->
          <form method="POST" action="/tasks/{{this.id}}" class="row editline">
            <input type="text" name="title" value="{{this.title}}" required>
            <select name="category_id">
              <option value="">No category</option>
              {{#each ../categories}}
                <option value="{{this.id}}" {{#if (eq this.id ../this.category_id)}}selected{{/if}}>{{this.name}}</option>
              {{/each}}
            </select>
            <button>Save</button>
          </form>
        </li>
      {{/each}}
    </ul>
  {{else}}
    <p class="muted">No tasks yet.</p>
  {{/if}}
</section>